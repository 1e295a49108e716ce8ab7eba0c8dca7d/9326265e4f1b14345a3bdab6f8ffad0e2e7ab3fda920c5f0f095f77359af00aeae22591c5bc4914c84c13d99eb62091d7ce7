<!DOCTYPE html>
<html lang="en">
  <head>
      <script>
      document.addEventListener('DOMContentLoaded', () => {
        const base = document.querySelector('base')?.href || window.location.origin + '/';
        document.querySelectorAll('[src], [href], [data-src], [data-href]').forEach(el => {
          for (const attr of ['src', 'href', 'data-src', 'data-href']) {
            const val = el.getAttribute(attr);
            if (val && val.includes('$base')) {
              el.setAttribute(attr, val.replace(/\$base\/?/g, base));
            }
          }
        });
      });
      </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>.shortpie.'s LocalSpace!</title>
    <base href="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/wowzas8@main/">
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="$base/style.css" />
    <link rel="icon" href="$base/fav.ico" />
  </head>

  <body>
    <div class="container">
      <h2 style="font-family: '8BitOperator', sans-serif;">welcome to</h2>
      <h1 class="shortpie">&nbsp;.shortpie.'s</h1>
      <br><br>
      <img src="localspace.png" alt="LocalSpace!" class="logo" />

      <div class="button-group">
        <div class="chapter-buttons">
          <button id="drweb" class="chapter-button-3">
            <span class="button-label">DELTARUNEWeb</span>
          </button>
          <button id="utweb" class="chapter-button-1">
            <span class="button-label">UNDERTALEWeb</span>
          </button>
        </div>

        <div class="othersite-button">
          <button id="abb" class="chapter-button-4">
            <span class="button-label">Open in about:blank?</span>
          </button>
        </div>
      </div>

      <h5 id="discord-link" style="font-size: 23px; margin-bottom: 14px; margin-top: 32px;">
        <br><a href="https://discord.gg/4nry3kY6Js" style="color: #5865F2;">
          Join the Discord for development updates and other projects!
        </a>
      </h5>

      <p>
        <strong style="font-size: 20px; color: #557;">base homepage made by </strong>
        <a href="https://github.com/aukak" style="font-size: 20px; color: #007bff; text-decoration: underline;">bog</a>
      </p>
    </div>

    <div id="gameFrame" class="game-frame hidden"></div>
    <script>
        async function loadthingy(path) {
          try {
            const res = await fetch(`${path}/index.html`);
            if (!res.ok) throw new Error(`Failed to load ${path}`);
            const html = await res.text();
            document.documentElement.innerHTML = html;
            document.documentElement.querySelectorAll('script').forEach(oldScript => {
              const newScript = document.createElement('script');
              if (oldScript.src) {
                newScript.src = oldScript.src;
              } else {
                newScript.textContent = oldScript.textContent;
              }
              document.body.appendChild(newScript);
            });
          } catch (err) {
            console.error(err);
            alert("yo error or sm idk ðŸ¥€");
          }
        }

      function abb() {
        const newTab = window.open('about:blank', '_blank');
        if (!newTab) {
          alert('Pop-up blocked! Please allow pop-ups...');
          return;
        }

        newTab.document.open();
        newTab.document.write(`
          <html>
            <head>
              <title>&#8203;</title>
              <style>
                html, body {
                  margin: 0;
                  padding: 0;
                  background: black;
                  overflow: hidden;
                  height: 100%;
                  width: 100%;
                }
                iframe {
                  border: none;
                  width: 100%;
                  height: 100%;
                }
              </style>
            </head>
            <body>
              <iframe id="localFrame" src="about:blank"></iframe>
            </body>
          </html>
        `);
        newTab.document.close();

        const interval = setInterval(() => {
          const frame = newTab.document.getElementById('localFrame');
          if (frame && frame.contentDocument) {
            clearInterval(interval);

            let html = document.documentElement.outerHTML;
            html = html.replace(/<link[^>]*rel=["']icon["'][^>]*>/gi, '');
            html = html.replace(/<title>.*?<\/title>/i, '<title>&#8203;</title>');

            frame.contentDocument.open();
            frame.contentDocument.write(html);
            frame.contentDocument.close();
          }
        }, 50);
      }

      document.getElementById('drweb').addEventListener('click', () => loadthingy('drweb'));
      document.getElementById('utweb').addEventListener('click', () => loadthingy('utweb'));
      document.getElementById('abb').addEventListener('click', abb);
    </script>
  </body>
</html>
